diff -Naur x265_4.1.old/source/encoder/encoder.cpp x265_4.1/source/encoder/encoder.cpp
--- x265_4.1.old/source/encoder/encoder.cpp	2024-12-03 12:10:55.434249959 +0100
+++ x265_4.1/source/encoder/encoder.cpp	2024-12-03 12:10:55.564250736 +0100
@@ -1102,6 +1102,12 @@
             else
                 input = pic_in->userSEI.payloads[i];
 
+            if (frame->m_userSEI.payloads[i].payload && (frame->m_userSEI.payloads[i].payloadSize < input.payloadSize))
+            {
+                delete[] frame->m_userSEI.payloads[i].payload;
+                frame->m_userSEI.payloads[i].payload = NULL;
+            }
+
             if (!frame->m_userSEI.payloads[i].payload)
                 frame->m_userSEI.payloads[i].payload = new uint8_t[input.payloadSize];
             memcpy(frame->m_userSEI.payloads[i].payload, input.payload, input.payloadSize);
